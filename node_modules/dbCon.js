var db = require('mysql');
var dbPool;

exports.initDbPool = function(dbVars){
  dbPool = db.createPool(dbVars);
}

exports.dbQuery = function(database, query, args, callback){
  //consumes callback(err, results)
  dbPool.getConnection(function(err, connection){
    if(err){
      console.log('error getting connection fron pool: ' + err);
      callback(err, null);
      return;
    }
    connection.changeUser({database: database}, function(err){
      if(err){
        console.log('error changing database: ' + err);
        throw err;
      }
    });
    console.log('sending query: ' + query);
    var foo = connection.query(query, args, function(err, results){
      connection.release();
      if(err){
        console.log('error during query: ' + err);
        callback(err, null);
        return;
      }
      console.log('query successful');
      callback(null, results);
    });
    console.log(foo.sql);
  });
};

exports.escape = db.escape;
